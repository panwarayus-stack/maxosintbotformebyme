<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Generate Session â€” MR WEIRDO</title>
<link rel="stylesheet" href="/sessiongen.css" />
<style>
  /* minimal embedded styles so file is standalone */
  :root{--bg:#020204;--neon:#00ff7f;--muted:#7fae8a}
  html,body{height:100%;margin:0;font-family:ui-monospace,monospace;background:linear-gradient(180deg,#020204,#07120a);color:#dfffe0}
  .wrap{max-width:900px;margin:28px auto;padding:18px}
  .card{background:linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.35));padding:16px;border-radius:10px;border:1px solid rgba(0,255,127,0.06)}
  h1{color:var(--neon);margin:0 0 8px;font-size:20px}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
  input,select{padding:10px;border-radius:6px;border:1px solid rgba(0,255,127,0.06);background:rgba(0,0,0,0.25);color:var(--neon);min-width:0;flex:1}
  .actions{display:flex;gap:8px;margin-top:12px}
  button{background:var(--neon);color:#021005;border:none;padding:10px 12px;border-radius:6px;font-weight:800;cursor:pointer}
  button.alt{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--neon)}
  pre.output{background:#000;padding:12px;border-radius:8px;margin-top:12px;color:var(--neon);white-space:pre-wrap;word-break:break-word;border:1px solid rgba(0,255,127,0.04)}
  .small{font-size:12px;color:var(--muted);margin-top:8px}
  .note{font-size:12px;color:#ffd;opacity:0.9}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main" aria-live="polite">
      <h1>Session Generator</h1>
      <p class="small">Enter API ID, API Hash and phone number. Click <strong>Generate</strong> to produce a session artifact. This page will try to call <code>/api/generate_session</code> on the server. If the server is unavailable, a local (insecure) fallback session will be produced.</p>

      <div class="row">
        <div style="flex:1;min-width:160px">
          <label for="apiId">API ID</label>
          <input id="apiId" type="text" inputmode="numeric" placeholder="e.g. 123456" />
        </div>

        <div style="flex:2;min-width:200px">
          <label for="apiHash">API Hash</label>
          <input id="apiHash" type="text" placeholder="e.g. abcdef1234567890..." />
        </div>

        <div style="flex:1;min-width:160px">
          <label for="phone">Phone (with country code)</label>
          <input id="phone" type="text" placeholder="+919812345678" />
        </div>
      </div>

      <div class="row" style="margin-top:12px">
        <div style="flex:1;min-width:200px">
          <label for="ngrok">ngrok auth token (optional)</label>
          <input id="ngrok" type="text" placeholder="Ngrok authtoken (optional)" />
        </div>

        <div style="min-width:200px;display:flex;align-items:flex-end">
          <div style="width:100%">
            <div class="actions" role="group" aria-label="actions">
              <button id="generateBtn">Generate</button>
              <button id="clearBtn" class="alt">Clear</button>
              <button id="openViewer" class="alt" title="Open viewer (session.html)">&nbsp;Viewer&nbsp;</button>
            </div>
          </div>
        </div>
      </div>

      <div id="resultArea" style="display:none">
        <label style="margin-top:12px">Session String</label>
        <pre id="sessionOutput" class="output" aria-live="polite"></pre>

        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
          <button id="copyBtn" class="alt">Copy to clipboard</button>
          <button id="downloadBtn" class="alt">Download .session</button>
          <button id="openBtn" class="alt">Open in viewer</button>
        </div>
        <div class="note" id="noteArea"></div>
      </div>
    </div>
  </div>

  <script src="/sessiongen.js"></script>
  <script>
    // wire UI (small helpers)
    const genBtn = document.getElementById('generateBtn');
    const clearBtn = document.getElementById('clearBtn');
    const openViewer = document.getElementById('openViewer');

    const apiIdEl = document.getElementById('apiId');
    const apiHashEl = document.getElementById('apiHash');
    const phoneEl = document.getElementById('phone');
    const ngrokEl = document.getElementById('ngrok');

    const resultArea = document.getElementById('resultArea');
    const sessionOutput = document.getElementById('sessionOutput');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const openBtn = document.getElementById('openBtn');
    const noteArea = document.getElementById('noteArea');

    // generate -> call sessiongen (defined in sessiongen.js)
    genBtn.addEventListener('click', async () => {
      const api_id = apiIdEl.value.trim();
      const api_hash = apiHashEl.value.trim();
      const phone = phoneEl.value.trim();
      const ngrok = ngrokEl.value.trim();

      if (!api_id || !api_hash || !phone) {
        alert('Provide API ID, API Hash, and phone number');
        return;
      }

      genBtn.disabled = true;
      genBtn.textContent = 'Generating...';

      try {
        // sessiongen.generate returns { success, session, note }
        const resp = await window.sessiongen.generate({ api_id, api_hash, phone, ngrok });
        if (!resp || !resp.success) throw new Error(resp && resp.error ? resp.error : 'Generation failed');

        const session = resp.session;
        sessionOutput.textContent = session;
        resultArea.style.display = 'block';
        noteArea.textContent = resp.note || '';

      } catch (err) {
        alert('Error: ' + (err.message || err));
      } finally {
        genBtn.disabled = false;
        genBtn.textContent = 'Generate';
      }
    });

    clearBtn.addEventListener('click', ()=>{
      apiIdEl.value = ''; apiHashEl.value=''; phoneEl.value=''; ngrokEl.value=''; resultArea.style.display='none'; sessionOutput.textContent=''; noteArea.textContent='';
    });

    copyBtn.addEventListener('click', async ()=>{
      const txt = sessionOutput.textContent.trim();
      if (!txt) return;
      try { await navigator.clipboard.writeText(txt); copyBtn.textContent = 'Copied'; setTimeout(()=>copyBtn.textContent='Copy to clipboard',1200); }
      catch(e){ alert('Copy failed'); }
    });

    downloadBtn.addEventListener('click', ()=>{
      const txt = sessionOutput.textContent.trim();
      if (!txt) return alert('No session');
      const blob = new Blob([txt], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob); a.download = 'session.session'; a.click();
    });

    openBtn.addEventListener('click', ()=>{
      const txt = encodeURIComponent(sessionOutput.textContent.trim());
      if (!txt) return;
      window.open('/session.html?s=' + txt, '_blank');
    });

    openViewer.addEventListener('click', ()=> window.open('/session.html','_blank'));
  </script>
</body>
</html>
